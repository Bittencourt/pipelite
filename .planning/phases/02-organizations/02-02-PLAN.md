---
phase: 02-organizations
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - src/app/organizations/page.tsx
  - src/app/organizations/columns.tsx
  - src/app/organizations/data-table.tsx
  - src/components/nav-header.tsx
  - src/app/page.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can see a paginated list of organizations"
    - "User can navigate to organizations from the main nav"
    - "List shows organization name, website, industry, and owner"
  artifacts:
    - path: "src/app/organizations/page.tsx"
      provides: "Organizations list view"
      min_lines: 40
    - path: "src/app/organizations/columns.tsx"
      provides: "Table column definitions"
      contains: "ColumnDef"
    - path: "src/app/organizations/data-table.tsx"
      provides: "Paginated data table component"
  key_links:
    - from: "src/components/nav-header.tsx"
      to: "/organizations"
      via: "nav link when session exists"
    - from: "src/app/organizations/page.tsx"
      to: "src/db/schema/organizations.ts"
      via: "database query"
---

<objective>
Create the organizations list page with pagination and update the navigation to include the Organizations link.

Purpose: Provide a discoverable entry point for organization management with a clear overview of all organizations.
Output: Paginated organizations list page accessible from the main navigation.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan - schema and actions
@.planning/phases/02-organizations/02-01-SUMMARY.md

# Patterns to follow
@src/app/admin/users/page.tsx
@src/app/admin/users/columns.tsx
@src/app/admin/users/data-table.tsx
@src/components/nav-header.tsx
@src/app/page.tsx
@src/db/schema/organizations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create organizations list page with pagination</name>
  <files>src/app/organizations/page.tsx, src/app/organizations/columns.tsx, src/app/organizations/data-table.tsx</files>
  <action>
    Create the organizations list page following the admin/users pattern:
    
    1. Create `src/app/organizations/columns.tsx`:
       - "use client" directive
       - Import ColumnDef from @tanstack/react-table
       - Import Badge, Button from shadcn/ui
       - Import Building2, ExternalLink, Pencil, Trash2 from lucide-react
       - Define Organization type: { id, name, website, industry, ownerName, createdAt }
       - Create columns array with:
         - name: header "Name", cell shows name with Building2 icon
         - website: header "Website", cell shows link with ExternalLink icon (or "-" if null)
         - industry: header "Industry", cell shows industry (or "-" if null)
         - owner: header "Owner", cell shows ownerName
         - createdAt: header "Created", cell shows formatted date
         - actions: header "", cell has Edit and Delete buttons (onClick handlers will be wired in data-table)
    
    2. Create `src/app/organizations/data-table.tsx`:
       - "use client" directive
       - Copy pattern from src/app/admin/users/data-table.tsx
       - Accept columns, data, and refresh callback as props
       - Use useReactTable with getCoreRowModel
       - Pass refresh in meta for action column access
       - Render Table with header groups and rows
       - Show "No organizations found." for empty state
       - Add "Add Organization" button above table (will open dialog - placeholder for now)
    
    3. Create `src/app/organizations/page.tsx`:
       - Server component (no "use client")
       - Import db from "@/db"
       - Import organizations, users from schema
       - Import eq, isNull, desc from drizzle-orm
       - Import DataTable from "./data-table", columns from "./columns"
       - Import Card components from shadcn/ui
       - Import Building2 from lucide-react
       - Create getOrganizations function:
         - Join organizations with users to get owner name
         - Filter by deletedAt is null
         - Order by createdAt desc
         - Return mapped array with ownerName included
       - Render page with:
         - Title "Organizations" with description
         - Card with DataTable inside
       - Pass router.refresh as refresh prop to DataTable
    
    Note: The "Add Organization" button and edit/delete actions will be wired in Plan 02-03
  </action>
  <verify>
    npx tsc --noEmit passes
    Page renders at /organizations route
  </verify>
  <done>
    Organizations list page shows all non-deleted organizations
    Table displays name, website, industry, owner, created date
    Empty state shows when no organizations exist
    TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update navigation with Organizations link</name>
  <files>src/components/nav-header.tsx, src/app/page.tsx</files>
  <action>
    Update navigation to make organizations discoverable:
    
    1. Update `src/components/nav-header.tsx`:
       - Find the nav section inside the `{session?.user && (...)}` block
       - Replace the comment `{/* Main nav items will be added in later phases */}` with:
         - Link to /organizations with Building2 icon
         - Text "Organizations"
       - Style: flex items-center gap-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors
       - Import Building2 from lucide-react
    
    2. Update `src/app/page.tsx`:
       - Find the Organizations card in the dashboard grid
       - Change it from a placeholder to an actual link:
         - Wrap the card div in a Link to /organizations
         - Add hover effects (hover:border-primary transition-colors)
         - Update text: "Manage your organizations" instead of "Coming in Phase 2"
         - Import Link from next/link
       - Keep People and Pipelines cards as placeholders
  </action>
  <verify>
    npx tsc --noEmit passes
    Nav header shows Organizations link when logged in
    Home page Organizations card is clickable
  </verify>
  <done>
    NavHeader displays Organizations link for authenticated users
    Home page Organizations card links to /organizations
    TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
- Organizations list page accessible at /organizations
- Navigation shows Organizations link
- Table displays organization data correctly
- Empty state handles no organizations gracefully
</verification>

<success_criteria>
- `npm run build` succeeds
- Visiting /organizations shows the list page
- NavHeader has Organizations link (visible when logged in)
- Home page Organizations card is clickable
</success_criteria>

<output>
After completion, create `.planning/phases/02-organizations/02-02-SUMMARY.md`
</output>
