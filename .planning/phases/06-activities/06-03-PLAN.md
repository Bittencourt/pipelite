---
phase: 06-activities
plan: 03
type: execute
wave: 3
depends_on:
  - 06-02
files_modified:
  - src/app/activities/activity-calendar.tsx
  - src/app/activities/page.tsx
  - package.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can view activities in a week-view calendar"
    - "Calendar shows activities organized by due date"
    - "User can click an activity in calendar to edit it"
    - "User can navigate between weeks in the calendar"
    - "Calendar displays activity type with color coding"
  artifacts:
    - path: "src/app/activities/activity-calendar.tsx"
      provides: "Calendar component with week view"
      contains: "export function ActivityCalendar"
      min_lines: 80
    - path: "src/app/activities/page.tsx"
      provides: "Activities page with list/calendar tabs"
      contains: "ActivityCalendar"
  key_links:
    - from: "src/app/activities/activity-calendar.tsx"
      to: "react-big-calendar"
      via: "Calendar component import"
      pattern: "from 'react-big-calendar'"
    - from: "src/app/activities/activity-calendar.tsx"
      to: "date-fns"
      via: "dateFnsLocalizer"
      pattern: "dateFnsLocalizer"
    - from: "src/app/activities/page.tsx"
      to: "ActivityCalendar"
      via: "Calendar tab content"
      pattern: "ActivityCalendar"
---

<objective>
Add calendar view for activities using react-big-calendar with date-fns, enabling visual scheduling and week-based planning.

Purpose: Provide a calendar interface for viewing and managing activities by due date.
Output: Week-view calendar with activity display, navigation, and edit capabilities.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-activities/06-RESEARCH.md

# Reference: deals page structure
@src/app/deals/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install calendar dependencies</name>
  <files>
    package.json
  </files>
  <action>
Install react-big-calendar and date-fns packages:

```bash
npm install react-big-calendar date-fns
```

These are the recommended libraries from the research phase:
- react-big-calendar: Calendar component with week/month views
- date-fns: Date manipulation and formatting for localizer

Verify installation completes successfully.
</action>
  <verify>
    - `grep "react-big-calendar" package.json` shows dependency
    - `grep "date-fns" package.json` shows dependency
    - `npm run build` passes
  </verify>
  <done>
    - Both packages installed
    - No build errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ActivityCalendar component</name>
  <files>
    src/app/activities/activity-calendar.tsx
  </files>
  <action>
Create a client component calendar using react-big-calendar with date-fns localizer.

**Implementation:**

```typescript
'use client'

import { Calendar, dateFnsLocalizer, Views } from 'react-big-calendar'
import format from 'date-fns/format'
import parse from 'date-fns/parse'
import startOfWeek from 'date-fns/startOfWeek'
import getDay from 'date-fns/getDay'
import enUS from 'date-fns/locale/en-US'
import 'react-big-calendar/lib/css/react-big-calendar.css'

const locales = { 'en-US': enUS }

const localizer = dateFnsLocalizer({
  format,
  parse,
  startOfWeek,
  getDay,
  locales,
})

interface ActivityEvent {
  id: string
  title: string
  start: Date
  end: Date
  resource: {
    typeId: string
    typeName: string
    typeColor: string
    dealId?: string
    dealTitle?: string
    completedAt?: Date | null
  }
}

interface ActivityCalendarProps {
  activities: Activity[] // from getActivities
  activityTypes: ActivityType[]
  onSelectActivity: (activity: Activity) => void
}
```

**Key features:**
1. **Default view:** Week view (defaultView={Views.WEEK})
2. **Available views:** Week and Month only
3. **Container height:** Fixed height (h-[600px] or style={{ height: 600 }})
4. **Event styling:**
   - Use eventPropGetter to apply activity type color
   - Completed activities show with reduced opacity or strikethrough
5. **Event click:** onSelectEvent calls onSelectActivity callback
6. **Date display:** Use activity.dueDate for both start and end (point-in-time events)
7. **Toolbar:** Default toolbar with navigation (prev/next/today) and view switcher

**Event data transformation:**
- Map activities to ActivityEvent format
- Set start and end to dueDate (single point in time, use 1-hour duration)
- Include type info and deal info in resource object

**Styling considerations:**
- Import CSS: 'react-big-calendar/lib/css/react-big-calendar.css'
- Consider custom Tailwind overrides for better integration
- Ensure text is readable with activity type colors

CRITICAL: Calendar container MUST have explicit height or it won't render.
</action>
  <verify>
    - File exists with ActivityCalendar component
    - Uses react-big-calendar with date-fns localizer
    - Has week and month views
    - Container has explicit height
    - `npm run build` passes
  </verify>
  <done>
    - ActivityCalendar component created
    - Week/month views working
    - Events clickable for edit
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate calendar into activities page</name>
  <files>
    src/app/activities/page.tsx
  </files>
  <action>
Update the activities page to include the calendar view as a second tab.

**Changes to page.tsx:**

1. Import ActivityCalendar component
2. Update Tabs structure to include calendar:
   - Tab 1: "List" - existing ActivityList
   - Tab 2: "Calendar" - new ActivityCalendar

**Implementation pattern:**
```tsx
<Tabs defaultValue="list" className="w-full">
  <TabsList>
    <TabsTrigger value="list">List</TabsTrigger>
    <TabsTrigger value="calendar">Calendar</TabsTrigger>
  </TabsList>
  
  <TabsContent value="list">
    <ActivityList ... />
  </TabsContent>
  
  <TabsContent value="calendar">
    <ActivityCalendar 
      activities={activities}
      activityTypes={activityTypes}
      onSelectActivity={(activity) => {
        setSelectedActivity(activity)
        setEditDialogOpen(true)
      }}
    />
  </TabsContent>
</Tabs>
```

**Shared dialog state:**
- Both list and calendar views use the same ActivityDialog for editing
- Selected activity state shared between views
- Dialog closes and refreshes data on successful update

**URL state (optional but nice):**
- Use searchParams to persist active tab in URL
- ?view=list or ?view=calendar
- Allows sharing direct links to calendar view

Ensure:
- Tabs component from shadcn/ui is used
- Smooth transition between views
- Data stays in sync between views
</action>
  <verify>
    - Page has List and Calendar tabs
    - Calendar tab shows ActivityCalendar
    - Clicking event in calendar opens edit dialog
    - Both views share same data
    - `npm run build` passes
  </verify>
  <done>
    - Page has working tabs
    - Calendar view integrated
    - Edit works from calendar
  </done>
</task>

</tasks>

<verification>
- All 3 tasks completed
- TypeScript compiles: `npm run build`
- react-big-calendar and date-fns installed
- Calendar component renders with week view
- Page has list/calendar tabs
- Calendar events clickable
</verification>

<success_criteria>
- [ ] react-big-calendar and date-fns installed
- [ ] activity-calendar.tsx created with Calendar component
- [ ] Calendar uses date-fns localizer
- [ ] Calendar has explicit height (critical)
- [ ] Week and month views available
- [ ] Page has List and Calendar tabs
- [ ] Calendar events display activities
- [ ] Clicking calendar event opens edit dialog
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-activities/06-03-SUMMARY.md`
</output>
