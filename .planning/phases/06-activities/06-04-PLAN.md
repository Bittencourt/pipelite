---
phase: 06-activities
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/activities/activity-dialog.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Type dropdown in activity dialog shows activity types (Call, Meeting, Task, Email)"
    - "User can select an activity type when creating an activity"
    - "If activity types are missing, user sees helpful error message"
  artifacts:
    - path: "src/app/activities/activity-dialog.tsx"
      provides: "Activity dialog with type dropdown"
      change: "Add fallback UI for empty activity types"
  key_links:
    - from: "activity-dialog.tsx"
      to: "activityTypes prop"
      via: "SelectContent rendering"
      pattern: "activityTypes.map"
---

<objective>
Fix the Type dropdown issue in activity dialog by populating activity types in the database and adding helpful fallback UI when types are missing.

Purpose: Unblock activity creation - the Type dropdown currently appears non-functional because no activity types exist in the database.
Output: Working Type dropdown with all activity types available.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

## Gap Diagnosis

From UAT testing (06-UAT.md):
- Issue: Type dropdown not expanding/enabling selection
- Root Cause: `activityTypes` table is empty - seed script never run
- Severity: Major (blocks all activity creation)

## Current State

- Seed script exists: `drizzle/seed-activity-types.ts`
- NPM script available: `npm run db:seed-activities`
- Dialog has no fallback when `activityTypes` array is empty
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run database migration and seed activity types</name>
  <files></files>
  <action>
    Execute the following commands to ensure the database schema is up-to-date and activity types are populated:

    1. Run database migration to ensure schema is current:
       ```bash
       npm run db:migrate
       ```

    2. Run the seed script to populate activity types:
       ```bash
       npm run db:seed-activities
       ```

    The seed script handles existing types gracefully (won't create duplicates).
    Expected output: 4 activity types created (Call, Meeting, Task, Email).
  </action>
  <verify>
    Run the seed script and verify it outputs success messages for all 4 types:
    - "Created activity type: Call" or "Activity type already exists: Call"
    - Same for Meeting, Task, Email
  </verify>
  <done>Activity types table has 4 records: call, meeting, task, email</done>
</task>

<task type="auto">
  <name>Task 2: Add fallback UI for empty activity types</name>
  <files>src/app/activities/activity-dialog.tsx</files>
  <action>
    In `src/app/activities/activity-dialog.tsx`, add a helpful error state when no activity types are available.

    In the Type Select section (around line 249-275), wrap the SelectContent items with a conditional:

    ```tsx
    <SelectContent>
      {activityTypes.length === 0 ? (
        <div className="p-4 text-center text-muted-foreground text-sm">
          <p className="font-medium">No activity types available</p>
          <p className="mt-1">Run the seed script to add default types:</p>
          <code className="mt-1 block bg-muted px-2 py-1 rounded text-xs">
            npm run db:seed-activities
          </code>
        </div>
      ) : (
        activityTypes.map((type) => (
          <SelectItem key={type.id} value={type.id}>
            <div className="flex items-center gap-2">
              {type.icon && iconMap[type.icon]}
              {type.name}
            </div>
          </SelectItem>
        ))
      )}
    </SelectContent>
    ```

    This provides a helpful debug message if activity types are ever missing in the future.
  </action>
  <verify>
    - `npm run build` passes without errors
    - Dialog component handles empty activityTypes array gracefully
  </verify>
  <done>
    Activity dialog shows helpful message when no types available instead of appearing broken
  </done>
</task>

<task type="checkpoint:human-verify">
  <what-built>
    Fixed Type dropdown by:
    1. Running database migration
    2. Seeding activity types (Call, Meeting, Task, Email)
    3. Adding fallback UI in dialog for missing types
  </what-built>
  <how-to-verify>
    1. Start dev server: `npm run dev`
    2. Navigate to http://localhost:3000/activities
    3. Click "Add Activity" button
    4. Click on the Type dropdown
    5. Verify: Dropdown expands and shows 4 options (Call, Meeting, Task, Email) with icons
    6. Select "Meeting" and fill in other required fields (Title, Due Date)
    7. Click "Create Activity"
    8. Verify: Activity appears in the list with the selected type
  </how-to-verify>
  <resume-signal>Type "approved" if Type dropdown works, or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
After completing tasks:
- Activity types exist in database (4 records)
- Type dropdown in activity dialog shows all types
- User can create activities with selected type
- Fallback UI appears if types ever go missing
</verification>

<success_criteria>
- [ ] Database migration ran successfully
- [ ] Seed script populated 4 activity types
- [ ] Type dropdown expands and shows Call, Meeting, Task, Email
- [ ] User can select a type and create an activity
- [ ] Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-activities/06-04-SUMMARY.md`
</output>
