---
phase: 06-activities
plan: 02
type: execute
wave: 2
depends_on:
  - 06-01
files_modified:
  - src/app/activities/activity-dialog.tsx
  - src/app/activities/activity-list.tsx
  - src/app/activities/page.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can create a new activity with title, type, due date, and optional deal link"
    - "User can edit existing activities"
    - "User can delete activities with confirmation"
    - "User can view a list of activities with filtering by type and status"
    - "Activity list shows linked deal information with navigation"
    - "Overdue activities are visually highlighted"
  artifacts:
    - path: "src/app/activities/activity-dialog.tsx"
      provides: "Create/edit dialog for activities"
      contains: "export function ActivityDialog"
      min_lines: 100
    - path: "src/app/activities/activity-list.tsx"
      provides: "Data table view with filtering"
      contains: "export function ActivityList"
      min_lines: 80
    - path: "src/app/activities/page.tsx"
      provides: "Activities page with list view"
      contains: "ActivityList"
  key_links:
    - from: "src/app/activities/activity-dialog.tsx"
      to: "src/app/activities/actions.ts"
      via: "createActivity, updateActivity"
      pattern: "createActivity|updateActivity"
    - from: "src/app/activities/activity-list.tsx"
      to: "src/app/activities/actions.ts"
      via: "getActivities, deleteActivity, toggleActivityCompletion"
      pattern: "getActivities|deleteActivity"
    - from: "src/app/activities/activity-dialog.tsx"
      to: "deals dropdown"
      via: "Searchable deal selector"
      pattern: "deal"
---

<objective>
Create the activity list view and CRUD dialog, enabling users to manage activities with filtering and deal linking.

Purpose: Provide the primary UI for activity management with list view, create/edit dialogs, and filtering.
Output: Functional activity list page with full CRUD capabilities and deal context display.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/getencode-get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-activities/06-RESEARCH.md

# Reference patterns
@src/app/deals/deal-dialog.tsx
@src/app/organizations/_components/data-table.tsx
@src/app/people/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ActivityDialog component</name>
  <files>
    src/app/activities/activity-dialog.tsx
  </files>
  <action>
Create a client component dialog for creating and editing activities.

**Props interface:**
```typescript
interface ActivityDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  activity?: Activity | null // null = create mode, object = edit mode
  activityTypes: ActivityType[]
  deals: Deal[] // for searchable dropdown
  onSuccess?: () => void
}
```

**Form fields (using react-hook-form + zod):**
1. **Title** - text input, required, 1-200 chars
2. **Type** - Select dropdown with activity types (name + icon), required
3. **Due Date** - DatePicker/Calendar from shadcn, required, includes time
4. **Deal** - Searchable Select/Combobox for deals (optional)
   - Show deal title, pipeline name, stage name
   - Filter deals by search text
   - Allow clearing selection
5. **Notes** - Textarea, optional, max 2000 chars

**Implementation details:**
- Use Dialog from shadcn/ui
- Use Form, FormField, FormItem, FormLabel, FormControl, FormMessage
- Use watch/setValue for Select components (pattern from people dialogs)
- Call createActivity or updateActivity based on mode
- Show toast on success/error using sonner
- Reset form on successful submission
- Include Delete button in edit mode (red, calls deleteActivity)

**Icons for activity types (Lucide):**
- Phone for Call
- Users for Meeting
- CheckSquare for Task
- Mail for Email

Follow the pattern from src/app/deals/deal-dialog.tsx for form structure and validation.
</action>
  <verify>
    - File exists with ActivityDialog component
    - Form has title, type, dueDate, deal, notes fields
    - Create and edit modes both work
    - `npm run build` passes
  </verify>
  <done>
    - ActivityDialog component created with all form fields
    - Create/edit modes functional
    - Form validation working
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ActivityList data table component</name>
  <files>
    src/app/activities/activity-list.tsx
  </files>
  <action>
Create a client component data table for displaying activities with filtering.

**Props interface:**
```typescript
interface ActivityListProps {
  activities: Activity[]
  activityTypes: ActivityType[]
  onEdit: (activity: Activity) => void
  onDelete: (id: string) => void
  onToggleComplete: (id: string) => void
}
```

**Columns (using @tanstack/react-table):**
1. **Status** - Checkbox/badge showing Done/Not Done, clickable to toggle
   - Green checkmark if completed
   - Empty circle if not completed
   - Red/amber highlight if overdue (!completedAt && dueDate < now)
2. **Type** - Badge with icon and name, colored by activity type
3. **Title** - Text, links to activity detail or opens edit dialog
4. **Due Date** - Formatted date/time (MMM d, yyyy h:mm a)
   - Red text if overdue
   - Amber text if due today
5. **Deal** - If linked, show deal title as badge/link
   - Click navigates to deal detail
   - Show pipeline name in tooltip
6. **Actions** - Edit (pencil) and Delete (trash) buttons

**Overdue section at top:**
- Separate overdue activities from rest
- Show overdue count badge
- Visual red/amber highlighting

**Filtering controls (above table):**
- Type filter: Multi-select dropdown
- Status filter: All / Pending / Done / Overdue
- Owner filter: Dropdown (for future use)

**Implementation details:**
- Use DataTable pattern from organizations/people
- Use flex-row with gap-4 for filters
- Calculate isOverdue: !completedAt && new Date(dueDate) < new Date()
- Sort: overdue first, then by dueDate ascending
- Handle empty states gracefully

Follow the pattern from src/app/organizations/_components/data-table.tsx.
</action>
  <verify>
    - File exists with ActivityList component
    - Table shows Status, Type, Title, Due Date, Deal, Actions columns
    - Overdue activities highlighted and shown first
    - Filters working
    - `npm run build` passes
  </verify>
  <done>
    - ActivityList component created with filtering
    - Overdue handling implemented
    - Deal linking visible in table
  </done>
</task>

<task type="auto">
  <name>Task 3: Create activities page with list view</name>
  <files>
    src/app/activities/page.tsx
  </files>
  <action>
Create the activities page that combines the list and dialog components.

**Page structure (Server Component):**
1. Auth check - redirect to login if not authenticated
2. Fetch data:
   - getActivities() with all relations
   - getActivityTypes()
   - getDeals() for dropdown (from deals/actions.ts)
3. Render layout with:
   - Page header: "Activities" title + "Add Activity" button
   - ActivityList component with fetched data
   - ActivityDialog in create mode (triggered by Add button)
   - ActivityDialog in edit mode (triggered by list)

**State management (wrap in client component if needed):**
- Dialog open/closed state
- Selected activity for edit
- Refresh trigger after create/update/delete

**Layout:**
- Container with max-w-7xl
- Header with flex justify-between
- Add Activity button (primary, with Plus icon)
- ActivityList fills remaining space

**Future placeholder:**
- Include a Tabs component structure but only show "List" tab
- Placeholder for "Calendar" tab (will be implemented in 06-03)
- Use TabsList with TabsTrigger from shadcn/ui

**Navigation:**
- Add "Activities" link to main nav (src/components/nav-header.tsx or similar)
- Position after Deals

Follow the pattern from src/app/people/page.tsx.
</action>
  <verify>
    - Page renders at /activities
    - Activity list displays with real data
    - Add Activity button opens dialog
    - Create activity works and refreshes list
    - Navigation includes Activities link
    - `npm run build` passes
  </verify>
  <done>
    - /activities page renders correctly
    - Full CRUD flow works
    - Navigation updated
    - Tabs structure in place for calendar
  </done>
</task>

</tasks>

<verification>
- All 3 tasks completed
- TypeScript compiles: `npm run build`
- ActivityDialog handles create and edit
- ActivityList shows activities with overdue handling
- Page accessible at /activities
- Navigation includes Activities link
</verification>

<success_criteria>
- [ ] activity-dialog.tsx created with all form fields
- [ ] ActivityDialog has create and edit modes
- [ ] activity-list.tsx created with data table
- [ ] ActivityList shows overdue activities highlighted
- [ ] ActivityList has type and status filters
- [ ] page.tsx created with list view
- [ ] Create/edit/delete/toggle all work
- [ ] Navigation includes Activities link
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-activities/06-02-SUMMARY.md`
</output>
