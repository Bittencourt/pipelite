---
phase: 03-people
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/ui/select.tsx
  - src/app/people/columns.tsx
  - src/app/people/data-table.tsx
  - src/app/people/page.tsx
  - src/components/nav-header.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a paginated list of all people with name, email, organization, and owner"
    - "People link appears in the navigation header for authenticated users"
    - "People card on the dashboard is a clickable link to /people"
    - "shadcn Select UI component is available for use in person dialogs"
  artifacts:
    - path: "src/app/people/page.tsx"
      provides: "Server component fetching people with org and owner joins"
      contains: "leftJoin"
    - path: "src/app/people/columns.tsx"
      provides: "Column definitions for people data table"
      contains: "ColumnDef"
    - path: "src/app/people/data-table.tsx"
      provides: "Client-side data table with dialog state management"
      contains: "useReactTable"
    - path: "src/components/ui/select.tsx"
      provides: "shadcn Select UI component"
      contains: "SelectTrigger"
    - path: "src/components/nav-header.tsx"
      provides: "Navigation with People link"
      contains: "People"
  key_links:
    - from: "src/app/people/page.tsx"
      to: "src/db/schema/people.ts"
      via: "imports people schema for query"
      pattern: "import.*people.*from.*db/schema"
    - from: "src/app/people/page.tsx"
      to: "src/app/people/data-table.tsx"
      via: "passes data to DataTable component"
      pattern: "DataTable.*data="
    - from: "src/app/people/data-table.tsx"
      to: "src/app/people/columns.tsx"
      via: "imports Person type and uses columns"
      pattern: "import.*Person.*from.*columns"
---

<objective>
Create the people list page with data table, add navigation links, and install the shadcn Select component.

Purpose: Give users a way to view all their contacts in a paginated table, navigate to the people section, and prepare the Select component needed for organization linking in dialogs.
Output: People list page at /people, navigation link in header, clickable dashboard card, shadcn Select component.
</objective>

<execution_context>
@/home/pedro/.claude/get-shit-done/workflows/execute-plan.md
@/home/pedro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-people/03-RESEARCH.md
@.planning/phases/03-people/03-01-SUMMARY.md

Key reference files (mirror these patterns exactly):
@src/app/organizations/page.tsx
@src/app/organizations/columns.tsx
@src/app/organizations/data-table.tsx
@src/components/nav-header.tsx
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create people list page with data table</name>
  <files>
    src/components/ui/select.tsx
    src/app/people/columns.tsx
    src/app/people/data-table.tsx
    src/app/people/page.tsx
  </files>
  <action>
    **Step 1: Install shadcn Select component.**
    Run `npx shadcn@latest add select -y` to generate `src/components/ui/select.tsx`. This component is needed in Plan 03 for the organization dropdown, but install it now so the codegen happens cleanly before UI work.

    **Step 2: Create `src/app/people/columns.tsx`** mirroring organizations/columns.tsx:
    - `"use client"` directive
    - Import `ColumnDef` from `@tanstack/react-table`, `Link` from `next/link`, `Button` from `@/components/ui/button`, icons `Users`, `Pencil`, `Trash2`, `Building2` from `lucide-react`
    - Export `Person` type:
      ```
      export type Person = {
        id: string
        firstName: string
        lastName: string
        email: string | null
        phone: string | null
        notes: string | null
        organizationId: string | null
        organizationName: string | null
        ownerName: string | null
        createdAt: Date
      }
      ```
    - Export `columns` array with columns:
      - **Name**: accessor `lastName`, header "Name", cell renders `Users` icon + Link to `/people/${id}` showing "firstName lastName" combined
      - **Email**: accessor `email`, header "Email", cell shows email or `-` muted
      - **Phone**: accessor `phone`, header "Phone", cell shows phone or `-` muted
      - **Organization**: accessor `organizationName`, header "Organization", cell renders `Building2` icon + Link to `/organizations/${organizationId}` if org exists, otherwise `-` muted. Only render the link if organizationId AND organizationName both exist (handles soft-deleted orgs returning null name from left join)
      - **Owner**: accessor `ownerName`, header "Owner", cell shows ownerName or `-` muted
      - **Created**: accessor `createdAt`, header "Created", cell formats with `toLocaleDateString()`
      - **Actions**: id "actions", no header, cell renders Edit and Delete icon buttons using `table.options.meta?.onEdit` and `table.options.meta?.onDelete` callbacks (same `@ts-expect-error` pattern as organizations)

    **Step 3: Create `src/app/people/data-table.tsx`** mirroring organizations/data-table.tsx:
    - `"use client"` directive
    - Same imports as organizations data-table but referencing `Person` from `./columns`, `PersonDialog` from `./person-dialog`, `DeleteDialog` from `./delete-dialog`, `deletePerson` from `./actions`
    - Interface `DataTableProps` with `columns`, `data: Person[]`, `organizations` (for the person dialog org select -- type `{ id: string; name: string }[]`), `refresh?`
    - Same state management pattern: `dialogOpen`, `editingPerson`, `deleteDialogOpen`, `personToDelete`, `isDeleting`
    - Same handlers: `handleAddNew`, `handleEdit`, `handleDeleteClick`, `handleDeleteConfirm` (calls `deletePerson`), `handleSuccess`
    - Same `useReactTable` setup with `meta: { onEdit, onDelete }`
    - Same table rendering with "No people found." empty state
    - Render `PersonDialog` passing `organizations` prop (this component will be created in Plan 03, so for now just render the dialog placeholder -- OR better: include the dialog imports but don't render them yet, and just render the Add Person button and table). **Actually**: Since Plan 03 creates the dialogs, in this plan create the data-table WITH the dialog imports commented out or conditionally rendered. The simplest approach: **Create the full data-table structure but with the PersonDialog and DeleteDialog rendered as empty fragments or null if the components don't exist yet.**

    **Better approach:** Create the data-table fully functional WITH imports for PersonDialog and DeleteDialog. Since these files won't exist until Plan 03, DO import them but create minimal placeholder files:
    - Create `src/app/people/person-dialog.tsx` as a minimal stub: `"use client"\nexport function PersonDialog(props: any) { return null }`
    - Create `src/app/people/delete-dialog.tsx` as a minimal stub: `"use client"\nexport function DeleteDialog(props: any) { return null }`

    This lets the data-table compile and work (showing table + add button) while Plan 03 replaces the stubs with real implementations.

    The Add Person button text should say "Add Person" with Plus icon.

    **Step 4: Create `src/app/people/page.tsx`** mirroring organizations/page.tsx:
    - Server component (no `"use client"`)
    - Import `db` from `@/db`, `people`, `organizations`, `users` from `@/db/schema`, `isNull`, `desc`, `eq` from `drizzle-orm`
    - Import `DataTable` from `./data-table`, `columns` from `./columns`
    - Import Card components and `Users` icon from `lucide-react`
    - `getOrganizationsForSelect()` function: query `db.select({ id: organizations.id, name: organizations.name }).from(organizations).where(isNull(organizations.deletedAt)).orderBy(organizations.name)` -- this provides the org list for the person dialog dropdown
    - `getPeople()` function with left join to both organizations and users:
      ```
      db.select({
        id: people.id,
        firstName: people.firstName,
        lastName: people.lastName,
        email: people.email,
        phone: people.phone,
        notes: people.notes,
        organizationId: people.organizationId,
        organizationName: organizations.name,
        ownerName: users.name,
        createdAt: people.createdAt,
      })
      .from(people)
      .leftJoin(organizations, and(eq(people.organizationId, organizations.id), isNull(organizations.deletedAt)))
      .leftJoin(users, eq(people.ownerId, users.id))
      .where(isNull(people.deletedAt))
      .orderBy(desc(people.createdAt))
      ```
      **Important:** Filter the organizations join with `isNull(organizations.deletedAt)` so soft-deleted orgs show as null (no organization) rather than showing a deleted org name. This is pitfall #2 from research.
    - Page component renders same Card structure as organizations but with `Users` icon and "People" / "Manage your contacts and their details" text
    - Pass both `data={peopleData}` and `organizations={orgsForSelect}` to `DataTable`

    Run `npx tsc --noEmit` to verify compilation.
  </action>
  <verify>
    1. `npx tsc --noEmit` passes with zero errors
    2. `src/components/ui/select.tsx` exists (shadcn codegen)
    3. People list page renders at /people with correct table structure
    4. Column definitions include Name (as link), Email, Phone, Organization, Owner, Created, Actions
  </verify>
  <done>
    People list page exists at /people with data table showing people with organization and owner joins. shadcn Select component installed. Stub dialogs allow compilation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add People navigation link and dashboard card</name>
  <files>
    src/components/nav-header.tsx
    src/app/page.tsx
  </files>
  <action>
    **Update `src/components/nav-header.tsx`:**
    - Add `Users` to the lucide-react import (alongside existing `Building2`)
    - Inside the `<nav>` element (after the Organizations link), add a People link:
      ```
      <Link
        href="/people"
        className="flex items-center gap-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"
      >
        <Users className="h-4 w-4" />
        People
      </Link>
      ```

    **Update `src/app/page.tsx`:**
    - Replace the static People `<div>` card (the one saying "Coming in Phase 3") with a clickable `<Link>` matching the Organizations card pattern:
      ```
      <Link
        href="/people"
        className="p-6 border rounded-lg hover:border-primary transition-colors"
      >
        <h3 className="font-semibold">People</h3>
        <p className="text-sm text-muted-foreground">Manage your contacts</p>
      </Link>
      ```

    Run `npx tsc --noEmit` to verify.
  </action>
  <verify>
    1. `npx tsc --noEmit` passes
    2. NavHeader shows "People" link with Users icon when authenticated
    3. Home page People card is a clickable link to /people
  </verify>
  <done>
    Navigation header includes People link. Dashboard People card links to /people instead of showing "Coming in Phase 3".
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- zero TypeScript errors
2. Visit /people -- see empty data table with columns: Name, Email, Phone, Organization, Owner, Created, Actions
3. NavHeader shows People link with Users icon (visible when authenticated)
4. Home page People card is clickable and navigates to /people
5. `src/components/ui/select.tsx` exists from shadcn codegen
</verification>

<success_criteria>
- People list page at /people displays a data table with correct columns and joins
- Navigation header includes People link for authenticated users
- Dashboard People card is an active link
- shadcn Select component is installed and ready for dialog use
</success_criteria>

<output>
After completion, create `.planning/phases/03-people/03-02-SUMMARY.md`
</output>
